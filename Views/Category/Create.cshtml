@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Táº¡o danh má»¥c";
}

<div class="container mt-5">
    <h2 class="text-center text-primary mb-4">ðŸ“‚ ThÃªm danh má»¥c má»›i</h2>

    <form id="createCategoryForm">
        <div class="mb-3">
            <label class="form-label">TÃªn danh má»¥c</label>
            <input type="text" class="form-control" id="categoryName" required />
        </div>

        <div class="mb-3">
            <label class="form-label">MÃ´ táº£</label>
            <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
        </div>

        <button type="submit" class="btn btn-success w-100">Táº¡o danh má»¥c</button>
    </form>

    <div id="resultMessage" class="mt-3"></div>

    <h4 class="mt-5 text-secondary">ðŸ“‹ Danh sÃ¡ch danh má»¥c</h4>
    <ul id="categoryList" class="list-group mt-2"></ul>
</div>

<script>
async function loadCategories() {
    const res = await fetch("/category/list");
    const categories = await res.json();

    const list = document.getElementById("categoryList");
    list.innerHTML = "";
    categories.forEach(c => {
        list.innerHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">
            <span>${c.categoryName}</span>
            <small class="text-muted">${c.description ?? ""}</small>
        </li>`;
    });
}

document.getElementById("createCategoryForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const data = {
        categoryName: document.getElementById("categoryName").value,
        description: document.getElementById("categoryDescription").value
    };

    const res = await fetch("/category/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });

    const message = await res.text();
    let alertClass = message.includes("thÃ nh cÃ´ng") ? "success" :
                     message.includes("tá»“n táº¡i") ? "warning" : "danger";

    document.getElementById("resultMessage").innerHTML =
        `<div class="alert alert-${alertClass} text-center">${message}</div>`;

    if (alertClass === "success") {
        document.getElementById("createCategoryForm").reset();
        await loadCategories();
    }
});

document.addEventListener("DOMContentLoaded", loadCategories);
</script>
